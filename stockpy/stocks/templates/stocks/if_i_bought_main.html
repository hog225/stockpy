{% extends 'stocks/base.html' %}

<!--템플릿 라이브러리 로딩 -->
{% load crispy_forms_tags %}
{% load widget_tweaks %}

{% block scripts %}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript">
        $(function() {

            $(".stockNameAutoComplete").autocomplete({
                source: function(request, response) {
                    $.getJSON("/stocks/stock-name-autocomplete", { q: request.term }, response);
                },
                select: function(event, ui) {
                    console.log(ui.item);
                },

            });
            $("#id_market_name").change(function () {
                var selectedVal = $(this).val();
                if (selectedVal != ''){
                    $(".stockNameAutoComplete").removeAttr('disabled')
                    $.ajax({
                        url:"{% url 'marketSelectAjax' %}",
                        dataType:'json',
                        type:'POST',
                        data:{'selectedVal':selectedVal, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
                        success:function(result){
                            console.log(result)
                            $('#selectResult').text("Selected Market : " + result['selectedVal']);
                        }
                    });
                }
                else{
                    $(".stockNameAutoComplete").attr({
                        'disabled':'disabled',
                    })
                    $('#selectResult').text('');
                }


            });
        });
    </script>

{% endblock %}


{% block content %}
<h2>선택 오브 종목</h2>
<form method="post" action=".">
    {% csrf_token %}
    <div class="row">
      <div class="col-6">
        {{ form.market_name|as_crispy_field }}
      </div>
      <div class="col-6">
        {{ form.tech_anal_name|as_crispy_field }}
      </div>
      <div class="col-12">
        {{ form.stock_name|as_crispy_field }}
      </div>

        <div class="col-12">
            <p id="selectResult"></p>
      </div>
    </div>

    <button type="submit" class="btn btn-success">측정고고</button>

</form>
<hr class="mt-0 mb-4">

<div class="row">
    <form method="post" action="init-stocks">
        {% csrf_token %}
        <div class="row">

        </div>
        {% if user.is_authenticated and user.is_superuser %}
            <button type="submit" class="btn btn-success">CreateStockData</button>
        {% else %}
            <button type="submit" class="btn btn-success" style="display: none;">CreateStockData</button>
        {% endif %}
    </form>
    &nbsp;
    <form method="put" action="init-stocks">
        {% csrf_token %}
        <div class="row">

        </div>
        {% if user.is_authenticated and user.is_superuser %}
            <button type="submit" class="btn btn-success">UpdateStockData</button>
        {% else %}
            <button type="submit" class="btn btn-success" style="display: none;">UpdateStockData</button>
        {% endif %}
    </form>
</div>
{% endblock %}


